@using SignalR.Models
@using Microsoft.AspNet.Identity;
@model List<UserModel>
@{
    ViewBag.Title = "Home Page";
    var userName = User.Identity.Name;
    var userId = User.Identity.GetUserId();
}
@section Stylesheet{
    <style>
        .wraper {
            background-color: antiquewhite;
            width: 100%;
            height: 100%;
            margin-top: 10px;
        }

        .users {
            height: 100%;
            padding: 0;
        }

        .header {
            height: 50px;
            background-color: #dec6c6;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .list-user {
            height: 100%;
            padding: 10px;
        }

        .user {
            cursor: pointer;
        }

        .status {
            height: 10px;
            width: 10px;
            background-color: #757b75;
            display: inline-block;
        }

        .title {
            text-transform: uppercase;
            font-weight: 700;
            font-size: 16px;
        }

        .conversation {
            height: 100%;
            background-color: #d6efeb;
            padding: 0;
        }

        .nav-tabs {
            height: 50px;
            background-color: #e8b2b2;
            display: flex;
            align-items: center;
            padding-left: 5px;
        }

        .tab-content {
            padding: 10px;
        }

        .group-name {
        }

        .participants {
        }

        .conversation-body {
        }
    </style>
}
<div class="wraper">
    <div class="col-md-4 users">
        <div class="header">
            <span class="title">Thành viên</span>
            <button class="btn btn-success">Tạo nhóm chat</button>
        </div>
        <div class="list-user">
            <ul style="list-style-type:none;">
                @foreach (var item in Model)
                {
                    <li class="user" data-id="@item.UserId">
                        <span class="status"></span>
                        <span class="user-name">@item.UserName</span>
                    </li>
                }
            </ul>
        </div>
    </div>
    <div class="col-md-8 conversation">
        <ul class="nav nav-tabs">
            @*<li class="active"><a data-toggle="tab" href="#home">Home</a></li>*@
        </ul>
        <div class="tab-content">

        </div>
    </div>
</div>
@section scripts{
    <script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>
    <script src="~/Scripts/jquery.signalR-2.3.0.min.js"></script>
    <script src="~/signalr/hubs"></script>
    <script>
        $(function () {
            var userName =@Html.Raw(Json.Encode(userName));
            var userId=@Html.Raw(Json.Encode(userId));
            var groupChatHub = $.connection.groupChatHub;
            groupChatHub.client.getOnlineUsers = function (userIds) {
                //debugger;
                $('li.user .status').css("background-color", "#757b75");
                userIds.forEach((item, index) => {
                    $(`li.user[data-id=${item}] .status`).css("background-color", "green");
                });
            };
            $.connection.hub.start().done(function () {
                //debugger;
            });

            $("li.user").on("dblclick", (e) => {
                var userIdPar = $(e.currentTarget).data("id");
                if ($(e.currentTarget).children(".status").css("background-color") == "rgb(0, 128, 0)" && userId != userIdPar) { 
                    var userNamePar = $(e.currentTarget).children(".user-name").text();
                    var liTab = `<li class="active"><a data-toggle="tab" href="#${userId}">${userName}</a></li>`;
                    var divContent = `<div id="${userId}" class="tab-pane fade in active">
                        <div class="participants">
                            <b>Thành viên:</b> ${userName}, ${userNamePar}
                        </div>
                        <div class="conversation-body">
                        </div>
                    </div>`;
                    $(".nav-tabs").append(liTab);
                    $(".tab-content").append(divContent);
                }
                else {
                    return;
                }
                //debugger;
            });
        });
    </script>

}